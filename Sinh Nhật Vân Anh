import React, { useEffect, useRef, useState } from 'react';
import { motion } from 'framer-motion';
import { Heart } from 'lucide-react';

// 💖 BirthdayHeart.jsx — Phiên bản hồng ngọt ngào với trái tim nhỏ rơi xung quanh
// Thiết kế trong trẻo, đơn giản, tập trung vào hiệu ứng và cảm xúc.

export default function BirthdayHeart() {
  const [showMessage, setShowMessage] = useState(false);
  const canvasRef = useRef(null);
  const audioRef = useRef(null);

  // Hiệu ứng trái tim rơi
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    let width = (canvas.width = window.innerWidth);
    let height = (canvas.height = window.innerHeight);

    const hearts = [];
    const colors = ['#ffb6c1', '#ff69b4', '#ff85a2', '#ffc1cc', '#fff'];

    function createHeart() {
      for (let i = 0; i < 60; i++) {
        hearts.push({
          x: Math.random() * width,
          y: Math.random() * height,
          size: 6 + Math.random() * 10,
          speed: 1 + Math.random() * 2,
          alpha: 0.4 + Math.random() * 0.6,
          color: colors[Math.floor(Math.random() * colors.length)],
        });
      }
    }

    function drawHeart(x, y, size, color, alpha) {
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(size / 10, size / 10);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.bezierCurveTo(0, -3, -5, -3, -5, 1);
      ctx.bezierCurveTo(-5, 5, 0, 8, 0, 10);
      ctx.bezierCurveTo(0, 8, 5, 5, 5, 1);
      ctx.bezierCurveTo(5, -3, 0, -3, 0, 0);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.globalAlpha = alpha;
      ctx.fill();
      ctx.restore();
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      hearts.forEach((h) => {
        drawHeart(h.x, h.y, h.size, h.color, h.alpha);
        h.y += h.speed;
        if (h.y > height + 10) {
          h.y = -10;
          h.x = Math.random() * width;
        }
      });
      requestAnimationFrame(draw);
    }

    createHeart();
    draw();

    window.addEventListener('resize', () => {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    });
  }, []);

  const handleClick = () => {
    setShowMessage(true);
    if (audioRef.current) {
      audioRef.current.currentTime = 0;
      audioRef.current.play();
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-b from-pink-50 via-rose-100 to-pink-200 overflow-hidden relative">
      {/* Canvas hiệu ứng trái tim rơi */}
      <canvas ref={canvasRef} className="fixed inset-0 z-0 pointer-events-none" />

      {/* Hiệu ứng ánh sáng nền */}
      <div className="absolute inset-0 -z-10">
        <div className="absolute top-0 left-0 w-[500px] h-[500px] rounded-full bg-pink-200 opacity-30 blur-3xl animate-pulse" />
        <div className="absolute bottom-0 right-0 w-[400px] h-[400px] rounded-full bg-rose-300 opacity-30 blur-3xl animate-ping" />
      </div>

      {/* Nội dung chính */}
      <div className="z-10 text-center bg-white/60 backdrop-blur-lg px-10 py-12 rounded-3xl shadow-2xl border border-white/50 max-w-xl">
        <motion.button
          onClick={handleClick}
          whileHover={{ scale: 1.1 }}
          whileTap={{ scale: 0.95 }}
          className="mx-auto mb-6 w-32 h-32 flex items-center justify-center rounded-full bg-gradient-to-br from-pink-400 to-rose-500 text-white shadow-lg"
        >
          <Heart className="w-14 h-14 animate-pulse" />
        </motion.button>

        <h1 className="text-4xl font-extrabold text-rose-700 mb-2 drop-shadow-md">Chúc Mừng Sinh Nhật!</h1>
        {!showMessage && <p className="text-rose-500 text-sm mb-4">Nhấn vào trái tim để nhận lời chúc 💖</p>}

        {showMessage && (
          <motion.div
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.8 }}
            className="text-rose-700 text-lg leading-relaxed font-medium"
          >
            💕 Chúc bạn có một ngày sinh nhật thật ngọt ngào và đáng nhớ. Hãy cười thật tươi và tận hưởng từng khoảnh khắc nhé! 💫
          </motion.div>
        )}

        <audio ref={audioRef} src="https://cdn.pixabay.com/download/audio/2021/08/08/audio_3d5f7b1b5d.mp3?filename=happy-birthday-ambient-110691.mp3" preload="auto" />
      </div>

      {/* Nhãn footer */}
      <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-rose-500/70 bg-white/60 backdrop-blur-sm px-4 py-1 rounded-full shadow-sm border border-rose-100">
        Thiết kế hồng trong trẻo — bởi ChatGPT 💖
      </div>
    </div>
  );
}
